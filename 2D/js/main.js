(function(a,b,c){String.prototype.format=function(){var d=arguments;return this.replace(/\{(\d+)\}/g,function(e,f){return d[f]})};b.extend({CA:function(r){var l={speed:500,stepspeed:500,target:".ca_container",size:{x:10,y:7},threshold:5,template:{line:"#temp_line",item:"#temp_item"},isClose:true,noHoldExt:false,noColor:false},n,i,v=[],q=[],g,s,z=0,p=0,y=false,j=false,x=false,m=false;l=b.extend({},l,r);function e(C){var A=[],B,o=C.length;for(B=0;B<o;B+=1){if(C[B] instanceof Array){A[B]=e(C[B])}else{A[B]=C[B]}}return A}function f(o,A){return parseInt(Math.random()*(o-A+1)+A,10)}function k(o){var A={},C,B;for(B in o){C=b(o[B]).html();A[B]=C.substring(6,C.length-3)}return A}function d(o,A){return v[o][A]}function h(o,A){return i.eq(A*l.size.x+o)}function u(A,D,C,o){v[A][D]=C;var B=i.eq(D*l.size.x+A);B.find("span").text(C);if(!l.noColor&&!o){t(B,c,C)}}function t(B,A,D){if(A===c){if(B.hasClass("act")){B.attr("class","act c"+D)}else{B.attr("class","c"+D)}}else{var C=h(B,A);if(C.hasClass("act")){C.attr("class","act c"+D)}else{C.attr("class","c"+D)}}}function w(){if(x){return}x=true;var A=0;b("#circle").text(++p);q=e(v);if(!l.noColor&&l.noHoldExt){i.removeClass("loop")}if(!l.noColor){i.removeClass("curloop")}else{i.attr("class","")}for(var B=0;B<l.size.x;B++){for(var o=0;o<l.size.y;o++){if(d(B,o)<l.threshold){continue}if(B>0){q[B-1][o]+=1,q[B][o]-=1}if(o>0){q[B][o-1]+=1,q[B][o]-=1}if(B<l.size.x-1){q[B+1][o]+=1,q[B][o]-=1}if(o<l.size.y-1){q[B][o+1]+=1,q[B][o]-=1}}}for(var B=0;B<l.size.x;B++){for(var o=0;o<l.size.y;o++){if(q[B][o]!=d(B,o)){u(B,o,q[B][o]);if(!l.noColor){h(B,o).addClass("loop").addClass("curloop")}else{h(B,o).attr("class","loop")}}A+=(d(B,o)>=l.threshold)}}if(A===0){y=false;clearInterval(s)}x=false}return{init:function(C){l=b.extend({},l,C);n=b(l.target);v=[];for(var B=0;B<l.size.x;B++){v.push(new Array(l.size.y));for(var A=0;A<l.size.y;A++){v[B][A]=0}}this.build()},build:function(){var C="",o=k(l.template),D="";for(var A=0;A<l.size.y;A++){D="";for(var B=0;B<l.size.x;B++){D+=o.item.format(B,A,0)}C+=o.line.format(A,D)}n.append(C);i=n.find("li div")},start:function(){if(m){return}if(j){return}m=true;j=true;void function(){y=true;x=false;p=0;s=setInterval(w,l.speed)}();g=setInterval(function(){if(y){return}b("#times").text(z++);if(!l.noColor){i.removeClass("act")}else{i.attr("class","")}if(!l.noColor&&!l.noHoldExt){i.removeClass("loop").removeClass("curloop")}var o={x:0,y:0},A;o.x=f(-1,l.size.x);o.y=f(-1,l.size.y);A=h(o.x,o.y);u(o.x,o.y,d(o.x,o.y)+1);A.addClass("act");if(d(o.x,o.y)>=l.threshold){y=true;p=0;x=false;s=setInterval(w,l.speed)}else{y=false}j=false;if(p>1){console.log("step: "+z+";circle: "+p+";")}},l.stepspeed)},nextStep:function(){this.pause();y=true;void function(){x=false;w()}();void function(){if(y){return}b("#times").text(z++);if(!l.noColor){i.removeClass("act")}else{i.attr("class","")}if(!l.noColor&&!l.noHoldExt){i.removeClass("loop").removeClass("curloop")}var o={x:0,y:0},A;o.x=f(-1,l.size.x);o.y=f(-1,l.size.y);A=h(o.x,o.y);u(o.x,o.y,d(o.x,o.y)+1);A.addClass("act");if(d(o.x,o.y)>=l.threshold){p=0;x=false;w()}else{y=false}}()},pause:function(){m=false;y=false;x=false;j=false;clearInterval(g);clearInterval(s)},setV:function(C){var B;if(m){B=true;m=false}for(var A=0;A<l.size.x;A++){for(var o=0;o<l.size.y;o++){u(A,o,C)}}if(B){m=true}},setRandom:function(){var B;if(m){B=true;m=false}for(var A=0;A<l.size.x;A++){for(var o=0;o<l.size.y;o++){u(A,o,f(-1,5))}}if(B){m=true}},run_state:function(){return m}}}})})(window,jQuery);(function(a,b,c){b(document).ready(function(){var d=b.CA();d.init({speed:10,stepspeed:10,size:{x:40,y:40},isClose:true,noHoldExt:false,noColor:false});b("#run-check").on("click",function(){if(d.run_state()===false){d.start(),b(this).val("Stop")}else{d.pause(),b(this).val("Start")}});b("#run-next").on("click",function(){d.nextStep(),b("#run-check").val("Start")});b("#set-val-4").on("click",function(){d.setV(4)});b("#set-val-3").on("click",function(){d.setV(3)});b("#set-val-2").on("click",function(){d.setV(2)});b("#set-val-1").on("click",function(){d.setV(1)});b("#set-val-rnd").on("click",function(){d.setRandom()})})})(window,jQuery);